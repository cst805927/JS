# 第 **17** 章 事件 

- 本章内容

  - 理解事件流 

  - 使用事件处理程序 

  - 了解不同类型的事件 

- JavaScript与HTML的交互是通过什么实现的？

  - 事件

- 可以使用什么订阅事件？

  - 仅在事件发生时执行的监听器

    （也叫处理程序）

- 在传统软件工程领域，这个模型叫什么？

  - “观察者模式”，

- “观察者模式”能够做到什么的分离？

  - 页面行为与页面展示

## **17.1** 事件流

- 事件流描述了什么？
  - 页面接收事件的顺序

### **17.1.1** 事件冒泡 

- IE事件流被称为什么？

  - 事件冒泡

- 从最具体的元素（文档树中最深的节点）开始触发

  然后向上传播至没有那么具体的元素 （文档）

```
<!DOCTYPE html>
<html>
	<head>
		<title>Event Bubbling Example</title>
	</head>
	<body>
		<div id="myDiv">Click Me</div>
	</body>
</html>

```

- 在点击页面中的\<div>元素后，

  click事件会以如下顺序发生

  - (1) \<div> 
  - (2) \<body> 
  - (3) \<html> 
  - (4) document 

![image-20220416131126839](第 17 章 事件.assets/image-20220416131126839.png)

### **17.1.2** 事件捕获

- 如果前面的例子使用事件捕获，

  则点击\<div>元素会以下列顺序触发click事件

  - (1) document 

  - (2) \<html> 

  - (3) \<body> 

  - (4) \<div>

![image-20220416131509216](第 17 章 事件.assets/image-20220416131509216.png)

### **17.1.3 DOM**事件流 

- 事件流分为3个阶段？
  - 事件捕获
  - 到达目标
  - 事件冒泡。
- 点击\<div>元素会以的顺序触发事件

![image-20220416131952217](第 17 章 事件.assets/image-20220416131952217.png)

- 通常在事件处理时被认为是什么阶段的一部分？
  - 冒泡

## **17.2** 事件处理程序 

- 事件意味着什么？
  - 用户或浏览器执行的某种动作。
  - 比如，单击（click）、加载（load）、鼠标悬停（mouseover）

- 为响应事件而调用的函数被称为什么？
  - 事件处理程序（或事件监听器）

- 事件处理程序的名字以什么开头？
  - "on"
  - click事件的处理程序叫作onclick
  - load事件的处理程序叫作onload

### **17.2.1 HTML**事件处理程序 

- HTML事件处理程序属性的值必须是什么？
  - 能够执行的JavaScript代码。
- 如何实现在按钮被点击时执行某些JavaScript代码？

```
<input type="button" value="Click Me" onclick="console.log('Clicked')" />

```

- 如何在属性里使用双引号？

```
<input type="button" value="Click Me" onclick='console.log("Clicked")' />

```

- 在HTML中事件处理程序

  是否可以调用在页面其他地方定义的脚本？

  - 可以

```
<script>
	function showMessage() {
		console.log("Hello world!");
	}
</script>
<input type="button" value="Click Me" onclick="showMessage()" />

```

- 事件处理程序执行的代码可以访问什么作用域？
  - 全局作用域

- 在HTML中事件处理程序会创建什么来封装属性的值？
  - 一个函数
- 这个函数有一个特殊的局部变量？
  - event
  - 其中保存的就是event对象

```
<!-- 输出"click" --> 
<input type="button" value="Click Me" onclick="console.log(event.type)">
```

- 在这个函数中，this值相当于什么？
  - 事件的目标元素，

```
<!-- 输出"Click Me" --> 
<input type="button" value="Click Me" onclick="console.log(this.value)">
```

- document和元素自身的成员

  被当成什么变量来访问？

  - 局部

- 事件处理程序相当于如下代码

```
function func() {
	with (document) {
		with (this) {
			// 属性值
		}
	}
}

```

```
<!-- 输出"Click Me" --> 
<input type="button" value="Click Me" onclick="console.log(value)">
```

- 如果这个元素是一个表单输入框，

  则作用域链中还会包含什么？

  - 表单元素

- 事件处理程序相当于如下代码

```
function() {
    with (document) {
        with (this.form) {
            with (this) { // 属性值 
            }
        }
    }
}
```

- 事件处理程序如何访问同一表单中的其他成员？

```
<form method="post">
	<input type="text" name="username" value="" />
	<input
		type="button"
		value="Echo Username"
		onclick="console.log(username.value)"
	/>
</form>

```

- 在HTML中指定事件处理程序有什么问题？

  - 时机问题

    - 如果showMessage()函数是在页面后面，

      在按钮中代码的后面定义的，

      - 那么当用户在showMessage()函数被定义之前点击按钮时，就会发生错误。

  - 对事件处理程序作用域链的扩展

    在不同浏览器中可能导致不同的结果

  - HTML与JavaScript强耦合
    - 如果需要修改事件处理程序，
      - 则必须在HTML和JavaScript中修改代码。

```
<input type="button" value="Click Me" onclick="try{showMessage();}catch(ex) {}">
```

### **17.2.2 DOM0**事件处理程序 

- 每个元素都有小写的事件处理程序属性
  - 比如onclick。
- 只要把这个属性赋值为一个函数即可

```
let btn = document.getElementById("myBtn");

btn.onclick = function() {
	console.log("Clicked"); 
};
```

```
let btn = document.getElementById("myBtn"); 

btn.onclick = function () {
    console.log(this.id); // "myBtn" 
};
```

- DOM0事件处理程序是注册在事件流的什么阶段？
  - 冒泡 

- 如何移除通过DOM0方式添加的事件处理程序？
  - 将事件处理程序属性的值设置为null，

```
btn.onclick = null; // 移除事件处理程序
```

### **17.2.3 DOM2**事件处理程序

- 事件处理程序的赋值和移除？
  - addEventListener()
  - removeEventListener()。
- 接收3个参数？
  - 事件名
  - 事件处理函数
  - 一个布尔值，
    - true表示在捕获阶段调用事件处理程序，
    - false（默认值）表示在冒泡阶段调用事件处理程序

- 如何给按钮添加click事件处理程序？

```
let btn = document.getElementById("myBtn"); 

btn.addEventListener("click", () => { 
	console.log(this.id);
}, false);
```

- 使用DOM2方式的主要优势是什么？
  - 可以为同一个事件添加多个事件处理程序。

```
let btn = document.getElementById("myBtn");
btn.addEventListener(
	"click",
	() => {
		console.log(this.id);
	},
	false
);
btn.addEventListener(
	"click",
	() => {
		console.log("Hello world!");
	},
	false
);

```

- 通过addEventListener()添加的事件处理程序

  - 只能使用removeEventListener()

    并传入与添加时同样的参数来移除。

- 使用addEventListener()添加的匿名函数是否能移除？
  - 不能

```
let btn = document.getElementById("myBtn");
btn.addEventListener(
	"click",
	() => {
		console.log(this.id);
	},
	false
);
// 其他代码 
btn.removeEventListener("click", function () { 
// 没有效果！
    console.log(this.id);
}, false);

```

- 传给removeEventListener()的事件处理函数

  必须与传给addEventListener()的是同一个

```
let btn = document.getElementById("myBtn");

let handler = function () {
	console.log(this.id);
};

btn.addEventListener("click", handler, false);

// 其他代码

btn.removeEventListener("click", handler, false); // 有效果！

```

